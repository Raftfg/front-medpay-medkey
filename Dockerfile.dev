# Dockerfile pour le développement avec Hot-Reload
FROM node:18-alpine

# Install git and bash (required by some npm/yarn packages)
RUN apk add --no-cache git bash

# Désactiver corepack et installer yarn v1 (compatible avec le projet)
RUN corepack disable && \
    npm install -g yarn@1.22.22

# Set working directory
WORKDIR /app

# Copy package files
COPY package*.json yarn.lock* ./

# Configure yarn with increased timeouts and better network handling
# Ignore engine checks to allow Node.js 18 compatibility
RUN yarn config set network-timeout 600000 && \
    yarn config set network-concurrency 1 && \
    yarn config set http-timeout 600000

# Install dependencies in the image (sera utilisé si le volume node_modules n'existe pas)
RUN yarn install --network-timeout 600000 --network-concurrency 1 --ignore-engines --frozen-lockfile || \
    yarn install --network-timeout 600000 --network-concurrency 1 --ignore-engines

# Copy entrypoint script
COPY docker-entrypoint.sh /app/docker-entrypoint.sh
RUN chmod +x /app/docker-entrypoint.sh

# Expose le port du serveur de développement Vue
EXPOSE 8080

# Script d'entrée qui installe les dépendances si nécessaire puis démarre le serveur
CMD ["/bin/sh", "/app/docker-entrypoint.sh"]

